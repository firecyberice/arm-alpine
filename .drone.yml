#debug: true

build:
  image: firecyberice/rpi-docker:1.10.0-dev
  environment:
    - DOCKER_HOST=tcp://localhost:2375
  commands:
    - apk update && apk add curl tar gzip
    - export VERSION=$(cat VERSION)
#    - curl --silent https://raw.githubusercontent.com/docker/docker/master/contrib/mkimage-alpine.sh > mkimage-alpine.sh
    - chmod +x mkimage-alpine.sh
    - ./mkimage-alpine.sh -s -r ${VERSION}
    - ls -la
#    - docker tag firecyberice/armhf-alpine:${VERSION} tempalpine
#    - docker save --output=/drone/src/github.com/firecyberice/arm-alpine/temp.tar tempalpine

compose:
  docker:
    privileged: true
    image: firecyberice/rpi-docker:1.10.0-dev-dind

publish:
  docker:
#    load: /drone/src/github.com/firecyberice/arm-alpine/temp.tar
#    environment:
#      - DOCKER_LAUNCH_DEBUG=true
    username: $$DOCKER_USER
    password: $$DOCKER_PASS
    email: $$DOCKER_EMAIL
    repo: firecyberice/armhf-alpine
    tag: 
      - latest
      - v3.4
